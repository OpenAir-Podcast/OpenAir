name: Flutter CI # Renamed the workflow to reflect use of Flutter

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  # Adding workflow_dispatch allows manual triggering of the workflow
  workflow_dispatch:

jobs:
  ci:
    name: Continuous Integration Checks
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Flutter SDK # Use Flutter setup instead of Dart setup
        # This action installs the Flutter SDK, which includes the Dart SDK.
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'

      - name: Install Dependencies
        run: flutter pub get # Use 'flutter pub get' for Flutter projects

      - name: Verify Formatting
        # FIX: Switched from 'flutter format' to the reliable 'dart format'.
        # This resolves the "Could not find a command named 'format'" error.
        run: dart format --output=none --set-exit-if-changed . 

      - name: Analyze Project Source (Strict)
        # Passes '--fatal-infos' to enforce stricter code analysis
        run: flutter analyze --fatal-infos # Use 'flutter analyze' for Flutter lint rules

      - name: Run Tests
        # Runs all tests in the 'test/' directory
        run: flutter test # Use 'flutter test' for potential widget tests
